<!DOCTYPE html>
<html>
    <head>
        <title><%= title %></title>
        <link rel='stylesheet' href='/stylesheets/style.css' />
    </head>

    <body>
        <h1><%= title %></h1>
        <p>Welcome to <%= title %></p>

        <div id="container"></div>
        <br><br>
        <form id="book-form">
            Title: <input type="text" id="title"> <br><br>
            Author: <input type="text" id="author"> <br><br>
            Genre: <input type="text" id="genre"> <br><br>
            Release Year: <input type="int" id="release_year"> <br><br>
            Quantity: <input type="int" id="quantity"> <br><br>
            <input type="submit" value="Submit">
        </form>

        <script>
            document.getElementById("book-form").addEventListener("submit", onSubmit);

            function onSubmit() {
                let container = document.getElementById("container");
                container = "";
                let form = document.getElementById("book-form");
                form.addEventListener("submit", (e) => {
                    e.preventDefault();

                    // load variables from the form and construct a JSON object for the data
                    let newBook = {
                        "Title": document.getElementById("title").value,
                        "Author": document.getElementById("author").value,
                        "Genre": document.getElementById("genre").value,
                        "Release year": document.getElementById("release_year").value,
                        "Quantity": document.getElementById("quantity").value
                    }

                    console.log(document.getElementById("title").value);
                    console.log(document.getElementById("author").value);
                    console.log(document.getElementById("genre").value);
                    console.log(document.getElementById("release_year").value);
                    console.log(document.getElementById("quantity").value);
                    //container.innerHTML += JSON.stringify(newBook);
                    //window.location.reload();
                });
            }
            onSubmit();

            function showAllBooks(){
				let container = document.getElementById("container"); // load the container
				container.innerHTML = ""; // delete the content already inside the container
		        let req = "http://127.0.0.1:8000/api/book/"
		        fetch(req) // make a request to this endpoint
                .then(response => response.json()) // with our response, get the json data returned
                //.then(data => console.log(data));
                .then(data => {
                    container.innerHTML += `<ol id="book-list"></ol>`; // create an empty list 
                    data.forEach(elem => {
                        let bookList = document.getElementById("book-list"); // load the book lsit we just created
                        let bookString = `<li>${elem.title} - ${elem.author}</li> 
                                          <button onclick="viewSingleBook(${elem.id})">View</button>`; // create a new li element containing info on our book
                        bookList.innerHTML += bookString;
                    })
                }); 
			}
            showAllBooks();

            function viewSingleBook(bookId) {
                let container = document.getElementById("container");
                container.innerHTML = "";
                let req = "http://127.0.0.1:8000/api/book/" + bookId + "/";
                fetch(req)
                .then(response => response.json())
                .then(data => {
                    let bookString = `<p>Title: ${data.title}</p>
                                      <p>Author: ${data.author}</p>
                                      <p>Release Year: ${data.release_year}
                                      <br>
                                      <br>
                                      <button onclick="showAllBooks()">Home</button>`;
                    container.innerHTML += bookString;
                });
            }
            //viewSingleBook(1);
        </script>
    </body>
</html>